var store=require("store.js")(function(e){function r(e){return function(r,o,n,i){var s=t.getToken();(o=o||{}).forceUseToken&&(s=o.forceUseToken,delete o.forceUseToken);var a=t.config.server.serverstr+r;o.forceUseUrl&&(a=o.forceUseUrl,delete o.forceUseUrl),$.ajax({headers:{authorization:s},data:o,url:a,async:!0,success:function(e,r,t){"function"==typeof n&&n(null,e,r,t)},type:e,error:function(e,r,o){if("function"==typeof n)return 401===e.status&&(t.cleanUserInfo(),window.location.href="signin.html"),void n("Error:"+r+o)}})}}var t=e.peapad={};t.config={server:function(){var e=window.location.host,r=window.location.protocol,o={};return"teacher.peapad.com.cn"===e?(t.ENV="production",o.serverstr=r+"//api.peapad.com.cn/api/t"):"teacher.peapad.cn"===e?(t.ENV="test",o.serverstr=r+"//api.peapad.cn/api/t"):(t.ENV="dev",o.serverstr="http://api.peapad.cn/api/t"),o}()},t.get=r("GET"),t.post=r("post"),t.userType={isTeacher:function(){var e=t.getUserInfo();return e&&"TEACHER"==e.type&&e.teacher},isOrganization:function(){var e=t.getUserInfo();return e&&e.organization}};t.isUserAuthExpire=function(){var e=store.get("expireTime");return!(e&&1*e>Date.now())},t.getUserInfo=function(){var e=store.get("expireTime");return e&&1*e>Date.now()?store.get("userInfo"):null},t.getToken=function(){var e=stroe.get("expireTime");return e&&e>Date.now()?store.get("token"):null},t.setToken=function(e){return store.set("token",e),store.set("expireTime",Date.now()+2592e6),e},t.setUserInfo=function(e){return store.set("userInfo",e),store.set("expireTime",Date.now()+2592e6),e},t.cleanUserInfo=function(){store.remove("expireTime"),store.remove("userInfo"),store.remove("token"),store.remove("auto_login")},e.redirect=function(r){e.location.href=r},t.uuid=function(e,r){e=e||32;var t,o="0123456789abcdefghijklmnopqrstuvwxyz".split(""),n=[];if(r=r||o.length,e)for(t=0;t<e;t++)n[t]=o[0|Math.random()*r];else{var i;for(n[8]=n[13]=n[18]=n[23]="-",n[14]="4",t=0;t<36;t++)n[t]||(i=0|16*Math.random(),n[t]=o[19==t?3&i|8:i])}return n.join("")}})(window);